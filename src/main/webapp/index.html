<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html ng-app="kexApp" class="no-js">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title></title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" href="css/bootstrap.min.css">
<style>
body {
	padding-top: 60px;
	padding-bottom: 40px;
}
</style>
<link rel="stylesheet" href="css/bootstrap-responsive.min.css">
<link rel="stylesheet" href="css/datetimepicker.css">
<link rel="stylesheet" href="css/main.css">

<!--[if lt IE 9]>
            <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <script>window.html5 || document.write('<script src="js/vendor/html5shiv.js"><\/script>')</script>
        <![endif]-->
</head>
<body>
	<!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

	<!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->


	<div id="fb-root"></div>


	<script type="text/javascript">
	window.fbAsyncInit = function() {
		  FB.init({
		    appId      : '571265879564450', // App ID
		    channelUrl : 'channel.html', // Channel File
		    status     : true, // check login status
		    cookie     : true, // enable cookies to allow the server to access the session
		    xfbml      : true  // parse XFBML
		  });

		  // Here we subscribe to the auth.authResponseChange JavaScript event. This event is fired
		  // for any auth related change, such as login, logout or session refresh. This means that
		  // whenever someone who was previously logged out tries to log in again, the correct case below
		  // will be handled.
		  FB.Event.subscribe('auth.authResponseChange', function(response) {
		    // Here we specify what we do with the response anytime this event occurs.
		    if (response.status === 'connected') {
		      // The response object is returned with a status field that lets the app know the current
		      // login status of the person. In this case, we're handling the situation where they
		      // have logged in to the app.
		      //testAPI();
		    	setAuthCookies();
		    } else if (response.status === 'not_authorized') {
		      // In this case, the person is logged into Facebook, but not into the app, so we call
		      // FB.login() to prompt them to do so.
		      // In real-life usage, you wouldn't want to immediately prompt someone to login
		      // like this, for two reasons:
		      // (1) JavaScript created popup windows are blocked by most browsers unless they
		      // result from direct user interaction (such as a mouse click)
		      // (2) it is a bad experience to be continually prompted to login upon page load.
		    	FB.login(function(response) {
		    	    if (response.authResponse) {
		    	        // The person logged into your app
		    	    	setAuthCookies();
		    	    } else {
		    	        // The person cancelled the login dialog
		    	    }
		    	});
		    } else {
		      // In this case, the person is not logged into Facebook, so we call the login()
		      // function to prompt them to do so. Note that at this stage there is no indication
		      // of whether they are logged into the app. If they aren't then they'll see the Login
		      // dialog right after they log in to Facebook.
		      // The same caveats as above apply to the FB.login() call here.
		    	FB.login(function(response) {
		    	    if (response.authResponse) {
		    	        // The person logged into your app

		    	        setAuthCookies();
		    	    } else {
		    	        // The person cancelled the login dialog
		    	    }
		    	});
		    }
		  });
		  };

		// Load the SDK Asynchronously
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) {
				return;
			}
			js = d.createElement(s);
			js.id = id;
			js.src = "//connect.facebook.net/en_US/all.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

		function setAuthCookies()
		{

			FB.getLoginStatus(function(response) {
				  if (response.status === 'connected') {
				    // the user is logged in and has authenticated your
				    // app, and response.authResponse supplies
				    // the user's ID, a valid access token, a signed
				    // request, and the time the access token
				    // and signed request each expire

				    $.cookie("facebook-uid",response.authResponse.userID);
				    $.cookie("facebook-token",response.authResponse.accessToken);
				    $.cookie("login","facebook");


				  } else if (response.status === 'not_authorized') {
				    // the user is logged in to Facebook,
				    // but has not authenticated your app
					  $.removeCookie("facebook-uid");
					  $.removeCookie("facebook-token");
    				  $.removeCookie("login");

				  } else {
				    // the user isn't logged in to Facebook.
					  $.removeCookie("facebook-uid");
					  $.removeCookie("facebook-token");
    				  $.removeCookie("login");

				  }
				 });

		}
	</script>




<div class="navbar navbar-fixed-top navbar-inverse nav">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="/">KarmaExchange</a>
			
          	<div class="nav-collapse collapse">
              <ul class="nav">
                  <li class="divider-vertical"></li>
                  <li><a href="#/home"><i class="icon-home icon-white"></i> Home</a></li>
                  <li><a href="#/events"><i class="icon-list icon-white"></i> Events</a></li>
      			  <li><a href="#/me"><i class="icon-user icon-white"></i> Me</a></li>
              </ul>
              <div class="pull-right">
                <ul class="nav pull-right">
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Welcome, {{me.firstName}} <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="/user/preferences"><i class="icon-cog"></i> Preferences</a></li>
                            <li><a href="/help/support"><i class="icon-envelope"></i> Contact Support</a></li>
                            <li class="divider"></li>
                            <li><a href="/#" onclick="FB.logout();"><i class="icon-off"></i> Logout</a></li>
                        </ul>
                    </li>
                </ul>
              </div>
            </div>
        </div>
    </div>
</div>
	<div class="container">
		<div ng-view></div>
	</div>
	<div>
        <fb:login-button show-faces="true" width="200" max-rows="1"></fb:login-button>
    </div>
	<script
		src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>
		window.jQuery
				|| document
						.write('<script src="js/vendor/jquery-1.9.1.min.js"><\/script>')
	</script>
	<script src="js/vendor/angular.min.js"></script>

	<script src="js/vendor/angular-resource.min.js"></script>
	<script src="js/vendor/angular-cookies-min.js"></script>
	<script src="js/vendor/jquery-cookie-min.js"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false&language=en"></script>
	<script src="js/vendor/angular-googlemaps-min.js"></script>
	<script src="js/vendor/bootstrap-datetimepicker.min.js"></script>

	<script src="js/plugins.js"></script>
	<script src="js/app.js"></script>
	<script type="text/javascript">
	    $('.form_datetime').datetimepicker({
	        format: "dd MM yyyy - HH:ii P",
	        showMeridian: true,
	        autoclose: true,
	        todayBtn: true
	    });
	</script> 
	<script>
		var _gaq = [ [ '_setAccount', 'UA-XXXXX-X' ], [ '_trackPageview' ] ];
		(function(d, t) {
			var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
			g.src = ('https:' == location.protocol ? '//ssl' : '//www')
					+ '.google-analytics.com/ga.js';
			s.parentNode.insertBefore(g, s)
		}(document, 'script'));
	</script>
</body>
</html>
