<!DOCTYPE html>
<html>
<head>
  <title>Bootstrap Karma Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">
  <meta charset="UTF-8">
  <style type="text/css">
    body {
      padding-top: 10px;
    }

    .button-row {
      padding: 4px;
      text-transform:uppercase;
/*      font-variant:small-caps;
      text-transform:capitalize;*/
    }

    .button-header {
      text-transform:uppercase;
    }

    .panel-dark-gray {
      border-color: #6E6E6E;
    }

    .panel-dark-gray > .panel-heading {
      color:#fff;
      background-color: #6E6E6E;
      border-color: #6E6E6E;
    }

  </style>
</head>
<body>
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  <script src="/js/initappid.js"></script>
  <script type="text/javascript">
    // This is boilerplate code that is used to initialize the Facebook
    // JS SDK.
    window.fbAsyncInit = function() {
      FB.init({
        appId : fbAppId, // App ID
        status : true, // check login status
        cookie : true, // enable cookies to allow the server to access the session
        xfbml : true
      // parse page for xfbml or html5 social plugins like login button below
      });

      // Put additional init code here

      FB.getLoginStatus(function(response) {
        onStatus(response); // once on page load
        FB.Event.subscribe('auth.statusChange', onStatus); // every status change
      });
    };

    // Load the SDK Asynchronously
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {
        return;
      }
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function showBootstrapCurrentUserButton(response) {
      var uid = response.authResponse.userID;
      var token = response.authResponse.accessToken;
      var url = '/bootstrap/provider/fb/register';
      var form = '<form action="/bootstrap/provider/fb/register" method="get">'
          + '  <input type="hidden" name="uid" value="' + uid + '">'
          + '  <input type="hidden" name="token" value="' + token + '">'
          + '  <button type="submit" class="btn btn-block btn-default">BOOTSTRAP CURRENT USER</button>'
          + '</form>';
      document.getElementById('account-info').innerHTML = (form);
    }

    function showLoginButton() {
      document.getElementById('account-info').innerHTML = ('<button class="btn btn-block btn-primary" onclick="FB.login()">LOGIN AND CONNECT VIA FACEBOOK</button>');
    }

    /**
     * This will be called once on page load, and every time the status changes.
     */
    function onStatus(response) {
      // Log.info('onStatus', response);
      if (response.status === 'connected') {
        showBootstrapCurrentUserButton(response);
      } else {
        showLoginButton();
      }
    }
  </script>

  <div class="container">
    <div class="row">
      <div class="col-md-5 panel panel-primary">
        <div class="row text-center panel-heading">
          <span class="button-header">Admin Operations</span>
        </div>

        <div class="panel-body">
          <div class="row button-row">
            <div id="account-info"></div>
          </div>

          <div class="row button-row">          
            <a href="/bootstrap/test_resources" class="btn btn-block btn-primary">Bootstrap test resources</a>
          </div>

          <div class="row button-row">          
            <a href="/bootstrap/datastore_indexes" class="btn btn-block btn-default">Update datastore-indexes-auto.xml</a>
          </div>

          <div class="row button-row">          
            <a href="/task/process_event_completions" class="btn btn-block btn-default">Process newly completed events</a>
          </div>

          <div class="row button-row">          
            <a href="/task/compute_leaderboard" class="btn btn-block btn-default">Compute organization leaderboards</a>
          </div>

          <div class="row button-row">          
            <a href="/bootstrap/purge_resources" class="btn btn-block btn-danger">Delete all resources</a>
          </div>
        </div>
      </div>
    </div>

    <!--  Using this as a way to refresh the fb access token. Need to verify it works! -->
    <fb:facepile></fb:facepile>

  </div>

  <div id="fb-root"></div>

</body>
</html>
