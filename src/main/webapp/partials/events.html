<div id="intro-banner">
    <div id="hero">
        <div class="container">
            <h1 class="hero-text animated fadeInDown">Make earning and sharing <em>karma</em> part of your daily routine.</h1>
            <div class="cta animated fadeInDown">
                <a href="#!/tour" class="button-outline">Take a tour</a>
                <a href="" class="button-outline" ng-click="FbUtil.login()" ng-hide="isLoggedIn">Login</a>
            </div>
        </div>
    </div>
</div>

<div class="container event-search">

        <div class="input-group">
                <input class="form-control" type="text" ng-model="query" placeholder="Search for karma opportunities...">
                <span class="input-group-addon">
                        <i class="icon-search"></i>
                </span>
        </div>
        <!--
            Commenting this out until it becomes functional
            <div class="btn-group">
                <button class="btn btn-default" ng-click="showList()"><i class="icon-list"></i> List</button>
                <button class="btn btn-default" ng-click="showMap()"><i class="icon-globe"></i> Map</button>
            </div>
        -->
        <div ng-show="isMap" class="row col-md-12 vertical-panel-padding">
                <div  class="google-map"
                        refresh="!isMapElementHidden"
                        center="center"
                        zoom="zoom"
                        markers="markers"
                        latitude="latitude"
                        longitude="longitude"
                        mark-click="false"
                        draggable="true"
                        style="height: 600px; width: 100%">
                 </div>

        </div>
        <div ng-hide="isMap" class="vertical-panel-padding">

            <div ng-show="eventSearchTracker.isPending()">
                <loading-message msg="karma opportunities"></loading-message>
            </div>

            <div ng-show="(events.data.length == 0) && !eventSearchTracker.isPending()">
                <h4><em>No <span ng-show="query.length > 0">matching </span> upcoming events</em></h4>
            </div>

            <ul class="list-unstyled results upcoming-events" ng-hide="eventSearchTracker.isPending()">
                <li ng-repeat="event in events.data" id="event_{{event.key}}">

                    <div>
                        <h4 ng-show="event.showHeader" class="date">
                                {{event.startTime | date:event.dateFormat}}
                        </h4>

                        <div class="panel panel-default">
                            <div class="panel-body">

                                <div class="row">
                                    <div class="col-md-2 event-search-result-summary">
                                            <h4 class="margin-top-0">
                                                <a href ng-click="toggleEvent();">
                                                    {{event.startTime | date:'shortTime'}}
                                                </a>
                                            </h4>
                                            <event-registration-info
                                                registration-info="event.registrationInfo"
                                                type="'UPCOMING'">
                                            </event-registration-info>
                                    </div>
                                    <div class="col-md-10 event-search-result-summary">
                                            <div class="pull-left">
                                                    <h4 class="margin-0">
                                                        <a href ng-click="toggleEvent();">
                                                            <strong>{{event.title}}</strong>
                                                        </a>
                                                    </h4>
                                                    <a href ng-click="toggleEvent();">
                                                        <small class="text-muted">{{event.location.title}} in {{event.location.address.city}}</small>
                                                    </a>
                                            </div>
                                            <div class="pull-right">
                                                    <h4 class="margin-top-0 text-right">
                                                        <a href ng-click="toggleEvent();">
                                                            <karma-hours karma-points="event.karmaPoints"></karma-hours>
                                                        </a>
                                                    </h4>
                                                    <div class="pull-right">
                                                            <event-participant-imgs-mini event="event"></event-participant-imgs-mini>
                                                    </div>
                                            </div>
                                    </div>
                                </div>
                                <!-- TODO(avaliani):  ui-bootstrap collapse is not working. Investigate why.
                                    <div collapse="event.isCollapsed">
                                -->
                                <div ng-show="!event.isCollapsed">

                                    <div class="vertical-panel-padding" ng-show="modelEventFetchTracker.isPending()">
                                        <loading-message msg="event details"></loading-message>
                                    </div>

                                    <div class="single-row-resp-table" ng-show="!modelEventFetchTracker.isPending()">
                                        <div class="col-md-4 col-sm-12">
                                            <div class="header">
                                                What?
                                            </div>
                                            <div class="body">
                                                <truncate-and-link
                                                    text="modelEvent.description"
                                                    link-text="(more)"
                                                    href="#!/event/{{modelEvent.key}}"
                                                    limit="500" >
                                                </truncate-and-link>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-sm-4">
                                            <div class="header">
                                                When? Where?
                                            </div>
                                            <div class="body">
                                                <p>
                                                        <strong>{{modelEvent.startTime|date:'shortTime'}} - {{modelEvent.endTime|date:'shortTime'}}</strong>
                                                </p>

                                                <p>

                                                        <strong>{{modelEvent.location.title}}</strong><br>
                                                        <a href="//maps.google.com/?q={{event.location.address.street}}, {{event.location.address.city}}, {{event.location.address.state}}, {{event.location.address.zip}}, {{event.location.address.country}}" target="_blank">
                                                            {{modelEvent.location.address.street}}<br>
                                                            {{modelEvent.location.address.city}}, {{modelEvent.location.address.state}} {{modelEvent.location.address.zip}}<br>
                                                        </a>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-sm-4">
                                            <div class="header">
                                                Who?
                                            </div>
                                            <div class="body">
                                                <p>
                                                        Volunteers needed : <strong>{{modelEvent.maxRegistrations-modelEvent.numRegistered | limit10 }}</strong>
                                                </p>
                                                <p>
                                                        Volunteers attending: <strong>{{modelEvent.numRegistered}}</strong>
                                                </p>
                                                <p>
                                                        Organized by:
                                                </p>
                                                <p>
                                                        <org-event-summary org="event.organizationDetails"></org-event-summary>
                                                </p>
                                                <p>
                                                        Organizer:
                                                </p>
                                                <p>
                                                        <event-participant-summary user="modelEvent.firstOrganizer" type="'ORGANIZER'"></event-participant-summary>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-md-2 col-sm-4">
                                            <div class="header hide-xs">
                                                &nbsp;
                                            </div>
                                            <div class="body text-center">
                                                <p>

                                                        <button ng-show="{CAN_REGISTER:true}[modelEvent.registrationInfo]" class="btn btn-success" ng-click="register('REGISTERED')"><i class="icon-ok icon-white"></i> Register</button>
                                                        <button ng-show="{CAN_WAIT_LIST:true}[modelEvent.registrationInfo]" class="btn btn-success" ng-click="register('WAIT_LISTED')"><i class="icon-ok icon-white"></i> Wait list</button>
                                                        <!--
                                                                Not really needed anymore since we have a label containing the registration info.

                                                                <span ng-show="{REGISTERED:true}[modelEvent.registrationInfo]">
                                                                        <i class="icon-ok"></i> You are registered!
                                                                </span>
                                                                <span ng-show="{WAIT_LISTED:true}[modelEvent.registrationInfo]">
                                                                        <i class="icon-ok"></i> You are waitlisted!
                                                                </span>
                                                        -->
                                                </p>
                                                <p>
                                                        <a href="#!/event/{{modelEvent.key}}" class="btn btn-info"><i class=" icon-info-sign icon-white"></i> More info</a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>

                    </div>

                </li>
            </ul>

        </div>

</div>
